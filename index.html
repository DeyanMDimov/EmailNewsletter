<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <link rel="stylesheet"href="css/bootstrap.min.css">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.3.min.js"><\/script>')</script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/jquery.blockUI.js" type="text/javascript"></script>
        <script src="js/code-blocks.js" type="text/javascript"></script>
        <script type="text/javascript"> 
        $( 
            
        function($){    
            $.extend({
                el: function(el, props, text) {
                    var $el = $(document.createElement(el));
                    $el.attr(props);
                    if(text != undefined)
                        $el.text(text);
                    return $el;
                }
            });
            
        var weekOf; 
        var numberOfMeetups;
        var meetups = [];
        var container = $('.col-md-8#form');
        var setBlockingStyle = function(){
            var defaults = $.blockUI.defaults;
            defaults.overlayCSS = {
                backgroundColor: '#27ae60',
				opacity:			0.9,
            };
            defaults.css = {
                padding:	0,
				margin:		0,
				width:		'30%',
				top:		'30%',
				left:		'35%',
				textAlign:	'center',
				color:		'#fff',
				border:		'none',
				background: 'none',
                fontSize:   '20px',
            };
            defaults.centerY = false;
        }();
        
        var meetup = function(name, event, date, address, description, id, featured, featuredPerson, url) {
            this.group = name;
            this.eventTitle = event;
            this.eventDate= date;
            this.eventAddress= address;
            this.eventDesc= description;
            this.id = id;
            this.groupIcon= '';
            this.completed = true;
            this.featured = featured;
            this.featuredPerson = featuredPerson;
            this.url = url;
        };
        
        var insertContainer = function(element){
            element.append($.el('div', {'class':'container-fluid'}));
            return element.children('.container-fluid');
        };
        
        var insertRow = function(element){
            var row = $.el('div', {'class':'row'});
            element.append(row);
            return row;
        };
        
        var insertInputRow = function(name, inputId, inputType){
            return [$.el('label', {'class':'control-label col-md-6'}, name), $.el('input', {'id':inputId, 'type': (inputType || 'text')})];
        };
        
        var createMeetUpForm = function(rowNum, meetNum){
            
            var meetUpRow = $('#meet-ups'+rowNum);
            if(meetUpRow.length==0)
            meetUpRow = $.el('div', {'class': 'row big-buffer', 'id': 'meet-ups'+rowNum});
            
            var meetUpContainer = $.el('div', {'class':'col-md-6', 'id':"meet-up"+meetNum});
            
            meetUpRow.append(meetUpContainer)
            container.append(meetUpRow);
            
                meetUpContainer = insertContainer(meetUpContainer);
            
            var row = insertRow(meetUpContainer);
                row.append(insertInputRow('Organizing Group', 'group-name'));
                
                row = insertRow(meetUpContainer);
                row.append(insertInputRow('Event Title', 'event-name'));
                
                row = insertRow(meetUpContainer);
                row.append(insertInputRow('Event Date', 'event-date', 'date'));
                
                row = insertRow(meetUpContainer);
                var eventDescriptionRow = insertInputRow('Event Description', 'event-desc');
                eventDescriptionRow[1].css('height', "150px");
                row.append(eventDescriptionRow);  
                
                row = insertRow(meetUpContainer);
                row.append(insertInputRow('URL', 'url'));
                
                row = insertRow(meetUpContainer);
                row.append(insertInputRow('Featured', 'featured', 'checkbox'));
                
                row = insertRow(meetUpContainer);
                row.append(insertInputRow('Featured WMPer', 'featured-person', 'text'));
                
                row = insertRow(meetUpContainer);
                row.append($.el('button', {'class':'meet-up-ready center-block top-buffer', 'id':meetNum}, 'Submit'));    
        };
        
        $('#set-week').click(function() {
            weekOf = $('#week-of').val();
        });
        
        $('#add-meet-up').click(function() {
          
            for(i=1; i<10; i++){
                var meetUpRow = $('#meet-ups'+i);
                if(meetUpRow.length <= 0){
                    createMeetUpForm(i, (i*2)-1);
                    return false;
                }
                else if($('#meet-up'+(i*2)).length<=0){
                    createMeetUpForm(i, i*2);
                    return false;
                }
            }
            
           
        });
        
        function submitMeetUp(meetNum){
            var meetContainer  = $('#meet-up'+meetNum)[0];
            
            var groupName = $('#'+ meetContainer.id +' #group-name')[0].value;
            var eventTitle = $('#'+ meetContainer.id +' #event-name')[0].value;
            var eventDate = $('#'+ meetContainer.id +' #event-date')[0].value;
            var eventDesc = $('#'+ meetContainer.id +' #event-desc')[0].value;
            //block Form
            $.blockUI.defaults.unblockMsg = '<h4 class="unblockBtn" id="'+meetNum+'">Edit</h4>';
            $('div#meet-up'+meetNum).block({message:"<h3>Completed</h3>"});
            
            
            var submittedMeetUp = $.grep(meetups, function(e){return e.id == meetNum;});
            if(submittedMeetUp.length == 0) {
                submittedMeetUp = new meetup(groupName, eventTitle, eventDate, '', eventDesc, meetNum);
                meetups.push(submittedMeetUp);
            }
            else{
                submittedMeetUp.completed = true;
            }
           
            
        };
        
        function unsubmitMeetUp(meetNum){
            var meetContainer  = $('#meet-up'+meetNum);
            $('div#meet-up'+meetNum).unblock();
            var selectedMeetUp = $.grep(meetups, function(e){ return e.id == meetNum; });
            if(selectedMeetUp.length == 1){
                selectedMeetUp[0].completed = false;
            }
        }
        
        function getWeeklyMessage(){
            var enteredMessage = $('#weeklyMessage')[0].value;
            var wholeMessage = "<p>Hey everyone,<br /><br />" + enteredMessage +"<br />,<br />Thanks and have a great week!<br />Deyan</p>";
            console.log(wholeMessage);
            return (enteredMessage.length > 0) ? wholeMessage : "";           
        }
        
        $('.container').on('click', '.meet-up-ready', function(){
            submitMeetUp(this.id);
            })
            .on('click', '.unblockBtn', function(){
            unsubmitMeetUp(this.id);
            });
            
        $('#generate-html').click(function(){
            var previewContainer = $('#code-preview');
            $.templateCode.setWeeklyMessage(getWeeklyMessage());
            previewContainer.text(weekOf ? weekOf:$.templateCode.codeBlocks[0]);
            $.templateCode.generateMeetUp('')
        }); 
        
       
        });
        </script>
        <style>
            .top-buffer{margin-top: 10px;}
            .big-buffer{margin-top: 25px;}
            
            .unblockBtn{font-weight: 300;
                        cursor: pointer;}
            #code-preview{ margin-top: 20px;
                           height: 800px;
                           overflow: scroll;}
           #add-meet-up{
               margin-top: 20px;
           }
           #weeklyMessage{
               width: 500px; 
               height: 100px;
           }
        </style>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <div class="container" id="main">
        <h2>Meet Up Email Generator</h2>
        <div class="row">
            <div class="col-md-8" id="form">
                <div class="row"> 
                    <div class="col-md-10">
                    <h4>The Week Of</h4><input id="week-of" type="date" />
                    <button id="set-week" >Submit</button>
                    </div>
                    <div class="col-md-2">
                    <button id="generate-html">Generate</button>
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="col-md-12">
                        <h3>Weekly Message</h3>
                         <textarea id="weeklyMessage"></textarea>
                    </div>
                    <div class="col-md-6">
                
                        <button id="add-meet-up" >Add Meet-Up</button><br /><br />
                       
                    </div>
                </div>
            </div>
            <div class="col-md-4" id="preview">
                <p class="form-control" id="code-preview">
                    
                </p>
            </div>
        </div>
        
        
        
        </div>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.3.min.js"><\/script>')</script>
        <script>
            
        </script>
    </body>
</html>
