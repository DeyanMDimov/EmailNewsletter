<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <link rel="stylesheet"href="css/bootstrap.css">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.3.min.js"><\/script>')</script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/jquery.blockUI.js" type="text/javascript"></script>
        <script src="js/code-blocks.js" type="text/javascript"></script>
        <script type="text/javascript"> 
        $( 
            
        function($){    
            $.extend({
                el: function(el, props, text) {
                    var $el = $(document.createElement(el));
                    $el.attr(props);
                    if(text != undefined)
                        $el.text(text);
                    return $el;
                }
            });
            
        var weekOf;   
        var numberOfMeetups;
        var meetups = [];
        var container = $('.col-md-12#form');
        var setBlockingStyle = function(){
            var defaults = $.blockUI.defaults;
            defaults.overlayCSS = {
                backgroundColor: '#27ae60',
				opacity:			0.9,
                borderRadius:       '4px'
            };
            defaults.css = {
                padding:	0,
				margin:		0,
				width:		'30%',
				top:		'30%',
				left:		'35%',
				textAlign:	'center',
				color:		'#fff',
				border:		'none',
				background: 'none',
                fontSize:   '20px',
            };
            defaults.centerY = false;
        }();
        
        var meetup = function(name, event, eventType, date, address, description, id, featured, featuredPerson, url, eventImage) {
            this.group = name;
            this.eventTitle = event;
            this.eventType = eventType;
            this.eventDate= date;
            this.eventAddress= address;
            this.eventDesc= description;
            this.id = id;
            this.groupIcon= eventImage;
            this.completed = true;
            this.featured = featured;
            this.featuredPerson = featuredPerson;
            this.url = url;
            this.farOut = checkFarOut(weekOf, date);
        };
        
        var checkFarOut = function(weekDate, meetupDate){
            weekDate = new Date(weekDate);
            var weekDateNumber = weekDate.getDate()+1;
            var meetupDateNumber = meetupDate.getDate()+1;
            var longMonths = [1,3,5,7,8,10,12];
            if(weekDateNumber+7 > meetupDateNumber ){
                //console.log(weekDate.getMonth()+1);
                if(weekDateNumber <= meetupDateNumber){
                    return false;
                }
                else{
                    if(longMonths.indexOf(weekDate.getMonth()+1) != -1 ){
                        if(meetupDateNumber < weekDateNumber+7-31){
                            return false;
                        }
                        else{return true;}
                    }
                    else if(longMonths.indexOf(weekDate.getMonth()+1) == -1 && weekDate.getMonth()+1 != 2){
                        if(meetupDateNumber < weekDateNumber+7-30){
                            return false;
                        }
                        else{return true;}
                    }
                    else{
                        if(meetupDateNumber < weekDateNumber+7-28){
                            return false;
                        }
                        else{return true;}
                    }
                }
            }
            else{ return true;}
        };
        
        var insertContainer = function(element){
            var blockUIRestraint = $.el('div', {'class':'block-cover'});
            blockUIRestraint.append($.el('div', {'class':'container-fluid meetup-container'}));
            element.append(blockUIRestraint);
            return blockUIRestraint.children('.container-fluid');
        };
        
        var insertRow = function(element){
            var row = $.el('div', {'class':'row'});
            element.append(row);
            return row;
        };
        
        var insertInputName = function( name, inputId){
            return [$.el('h5', {'id':inputId, 'class':'col-md-10 col-sm-10'}, name)];
        };
        
        var insertInputRow = function( inputId, inputType){
            return [$.el('input', {'id':inputId, 'type': (inputType || 'text'), 'class':'col-md-10 col-sm-5'})];
        };
        
        var insertInputTextBox = function( inputId, inputType){
            return [$.el('textarea', {'id':inputId, 'class':'col-md-10 col-sm-10'})];
        };
        
        var createMeetupForm = function(rowNum, meetNum){
            
            var meetupRow = $('#meet-ups'+rowNum);
            if(meetupRow.length==0)
            meetupRow = $.el('div', {'class': 'row big-buffer', 'id': 'meet-ups'+rowNum});
            var meetupContainer = $.el('div', {'class':'col-md-6 meetup', 'id':"meet-up"+meetNum});
            
            meetupRow.append(meetupContainer);
            container.append(meetupRow);
            
            
            
            
            var leftOffsetElement = function(){
                var elem =  $.el('h2', {'class':'meetupNum col-md-1 col-sm-1'});
                elem.html('&nbsp;');
                return elem;
            };

            
                meetupContainer = insertContainer(meetupContainer);
            
            var row = insertRow(meetupContainer);
                row.addClass('meetup-header');
                row.append($.el('h2',  {'class':'meetupNum col-md-12 col-sm-12', 'id': meetNum}, meetNum+'. New Event'));
                            
                row = insertRow(meetupContainer);
                row.addClass('meetup-top-row');
                row.append(insertInputName('Organizing Group', 'input-title'));
                row.append(insertInputRow( 'group-name'));
                
                row = insertRow(meetupContainer);
                row.append(insertInputName('Event Type', 'input-title'));
                row.append(insertInputRow('event-type'));
                //$('#meet-up' + meetNum +' #event-type')[0].value = "Meetup";
                
                row = insertRow(meetupContainer);
                row.append(insertInputName('Event Title', 'input-title'));
                row.append(insertInputRow('event-name'));
                
                row = insertRow(meetupContainer);
                row.append(insertInputName('Event Date','input-title'));
                row.append(insertInputRow( 'event-date', 'date'));
                
                row = insertRow(meetupContainer);
                row.append(insertInputName('Event Time', 'input-title'));
                row.append(insertInputRow('event-time'));
                
                row = insertRow(meetupContainer);
                row.append(insertInputName('Event Description', 'input-title'));
                var eventDescriptionRow = insertInputTextBox('event-desc');
                eventDescriptionRow[0].css('height', "150px");
                row.append(eventDescriptionRow);  
                
                row = insertRow(meetupContainer);
                row.append(insertInputName('URL', 'input-title'));
                row.append(insertInputRow('url'));
                
                row = insertRow(meetupContainer);
                row.append(insertInputName('Image URL', 'input-title'));
                row.append(insertInputRow('image-url'));
                
                row = insertRow(meetupContainer);
                row.append(insertInputName('Featured', 'input-title'));
                row.append(insertInputRow('featured', 'checkbox'));
                
                row = insertRow(meetupContainer);
                row.append(insertInputName('Featured WMPer', 'input-title'));
                row.append(insertInputRow('featured-person', 'text'));
                
                row = insertRow(meetupContainer);
                row.append(insertInputName('Address', 'input-title'));
                row.append(insertInputRow( 'event-address', 'text'));
                
                row = insertRow(meetupContainer);
                row.append($.el('button', {'class':'meet-up-ready col-md-4 col-sm-4 top-buffer', 'id':meetNum}, 'Submit')).append($.el('button', {'class':'clear-meetup col-md-4 col-sm-4 top-buffer', 'id':meetNum}, 'Clear Entries'));  
                
                 
        };
        
        $('#set-week').click(function() {
            weekOf = $('#week-of').val();
        });
        
        $('#add-meet-up').click(function() {
          
            for(i=1; i<10; i++){
                var meetupRow = $('#meet-ups'+i);
                if(meetupRow.length <= 0){
                    createMeetupForm(i, (i*2)-1);
                    return false;
                }
                else if($('#meet-up'+(i*2)).length<=0){
                    createMeetupForm(i, i*2);
                    return false;
                }
            }
            
           
        });
        
        function submitMeetup(meetNum){
            var meetContainer  = $('#meet-up'+meetNum)[0];
            
            var groupName = $('#'+ meetContainer.id +' #group-name')[0].value;
            var eventType = $('#'+ meetContainer.id +' #event-type')[0].value;
            var eventTitle = $('#'+ meetContainer.id +' #event-name')[0].value;
            var eventDate = new Date($('#'+ meetContainer.id +' #event-date')[0].value);
            var eventDesc = $('#'+ meetContainer.id +' #event-desc')[0].value;
            var eventMoreInfo = $('#'+ meetContainer.id +' #url')[0].value;
            var eventFeatured = $('#'+ meetContainer.id +' #featured')[0].checked;
            var eventFeaturedPerson = $('#'+ meetContainer.id +' #featured-person')[0].value;
            var eventAddress = $('#' + meetContainer.id +' #event-address')[0].value;
            var eventImage = $('#' + meetContainer.id +' #image-url')[0].value; 
            var eventTime = $('#' + meetContainer.id +' #event-time')[0].value; 
            var daysOfWeek =  ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            
            
            //block Form
            $.blockUI.defaults.unblockMsg = '<h4 class="unblockBtn" id="'+meetNum+'">Edit</h4>';
            $('div#meet-up'+meetNum+' .block-cover').block({message:"<h3>Completed</h3>"});
            
            if(groupName != null && groupName != ""){
                $('#'+ meetContainer.id +' .meetupNum')[0].innerText = meetNum + '. ' + groupName;
            }
            
            if(weekOf == null){
                var timeNow = new Date($.now);
                var dayOfWeek = timeNow.getDay()+1;
                if(dayOfWeek > 1 && dayOfWeek <5){
                    weekOf = new Date(timeNow.getFullYear, timeNow.getMonth, (timeNow.getDate - dayOfWeek + 1));
                }
                else{
                    weekOf = new Date(timeNow.getFullYear, timeNow.getMonth, (timeNow.getDate + 1 + 7 - dayOfWeek));
                }
                if(weekOf.getDate < 0){
                    
                }
            }
            
            var submittedNewMeetup = new meetup(groupName, eventTitle, eventType, eventDate, eventAddress, eventDesc, meetNum, eventFeatured, eventFeaturedPerson, eventMoreInfo, eventImage);
            submittedNewMeetup.daysOfWeek = daysOfWeek;
            submittedNewMeetup.time = eventTime;
            
            
            var submittedMeetup = $.grep(meetups, function(e){return e.id == meetNum;});
            if(submittedMeetup.length == 0) {
                meetups.push(submittedNewMeetup);
            }
            else{
               
                meetups[submittedNewMeetup.id - 1] = submittedNewMeetup;
            }
           
            
        };
        
        function unsubmitMeetup(meetNum){
            var meetContainer  = $('#meet-up'+meetNum);
            $('div#meet-up'+meetNum + ' .block-cover').unblock();
            var selectedMeetup = $.grep(meetups, function(e){ return e.id == meetNum; });
            if(selectedMeetup.length == 1){
                selectedMeetup[0].completed = false;
            }
        }
        
        function clearInputFields(meetNum){
            var Inputs = $('#meet-up'+meetNum+' input');
            Inputs.push($('#meet-up'+meetNum+' textarea')[0]);
            Inputs.each(function(){
                $(this).val("").removeAttr("checked");
            });
        }
        
        function getWeeklyMessage(){
            var enteredMessage = $('#weeklyMessage')[0].value;
            var wholeMessage = "Hey everyone,<br /><br />" + enteredMessage +"<br /><br />Thanks and have a great week!<br />Deyan";
            //console.log(wholeMessage);
            return (enteredMessage.length > 0) ? wholeMessage : "";           
        }
        
        $('.container').on('click', '.meet-up-ready', function(){
            submitMeetup(this.id);
            })
            .on('click', '.unblockBtn', function(){
            unsubmitMeetup(this.id);
            });
            
        $('.container').on('click', '.clear-meetup', function(){
            clearInputFields(this.id);
        });
        
        $(document).on('click', '#code-preview', function(){ selectText('code-preview'); });    
        
        $('#generate-html').click(function(){
            var previewContainer = $('#code-preview');
            $.templateCode.setWeeklyMessage(getWeeklyMessage());
            $.templateCode.generateMeetups($.grep(meetups, function(e){
                return e.completed == true;
            }));
            $.templateCode.templateClose();
            var htmlBlocks = $.templateCode.htmlBlocks;
            var html='';
            $.each(htmlBlocks, function(index, value){
                html = html.concat(value);
            });
            previewContainer.text(html);
            
        }); 
        
        
        
        function selectText(element) {
            var doc = document
                , text = doc.getElementById(element)
                , range, selection
            ;    
            if (doc.body.createTextRange) {
                range = document.body.createTextRange();
                range.moveToElementText(text);
                range.select();
            } else if (window.getSelection) {
                selection = window.getSelection();        
                range = document.createRange();
                range.selectNodeContents(text);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }
        
       
        });
        </script>
        <style>
            body{
                background-color: #F5F5F5;
                
            }
            * {
                font-family:  'HelveticaNeue-Light', 'Helvetica Nueu Light', Helvetica, 'Segoe UI', Calibri, sans-serif;
            }
/*            .col-sm-12{
                float:none !important;
            }*/
            
            .form-title{
                background-color: #082952;
                color: #FFB91C;
            }
            .form-title span{
                color: #F5F5F5;
            }
            .form-title h2, .form-title h2 span{
                font-family: 'Helvetica Neue Light', Helvetica, 'Segoe UI', Calibri, sans-serif !important;
            }
            #main{
                margin-top: 0px;
            }
            #week{
                display:inline-block;
                padding: 0 30px 0  0;
            }
            #week-of{visibility: hidden; display:none;}
            #set-week{
                margin-top: 30px;
                padding: 5px 5px 5px 5px;
                background: none;
                color: #ccc;
                font-size:12px;
                float:right;
            }
            #set-week:hover{
                color:#999;
            }
            
            #input-title{
                color:#666;
                display: block;
                float: none;
                margin: 5px auto 2px;
                padding: 0 5px;
                font-size:16px;
            }
            
            .input-style{
                border: none;
                background-color: #d6d6d6;
                border-bottom: solid 3px #454545;
            }
            
            #event-desc{
                height:150px;
                display: block;
                float: none;
                margin:5px auto;
                border: none;
                border-radius: 4px;
                color:#333;
                padding: 8px 10px;
            }
            .input-style:focus{
                background-color:#E0E0E0;
                outline:none;
            }
            
            #weeklyMsg-title{
                margin-bottom:5px;
                margin-top:5px;
                padding-left:1px;
            }
            
            
            
            #weeklyMessage{
                width: 100%; 
                height: 100px;
                padding:10px 13px;
                border-radius: 3px;
            }
            .top-buffer{margin-top: 10px;}
            .big-buffer{margin-top: 25px;}
            
            .btn{
                border-radius:3px;
            }
            
            .unblockBtn{font-weight: 300;
                        cursor: pointer;
                        }
            #add-meet-up, #generate-html{
                margin-top: 20px;
                font-size: 20px;
                width: 150px;
                margin-right: 25px;
                background: solid;
                background-color:#E0E0E0;
                border-bottom: solid 2px #454545;
                /*padding: 9px 24px 6px 13px;*/
                
            }
            .meetup .container-fluid{
                background-color:#ddd; 
                color:#fff;
                border-radius: 7px;
            }
            
            .meetup-container{
                
            }
            
            .meetup-header{
                border-radius: 7px 7px 0 0;
                background-color: #082952;
                padding: 10px;
            }
            
            .meetup-top-row{
                padding-top: 10px;
            }
            
            .meetup row{
                height:30px;
            }
            
            .meetup .container-fluid input{
                color:#111;
                display:block;
                margin: 5px auto;
                float: none;
                padding: 8px 10px;
                border: none;
                border-radius:3px;
            }
            
            .meetup-top-row input{
/*                margin-top: 0 !important;*/
            }
            
            .meet-up-ready, .clear-meetup{
                color:#111;
                margin: 15px 0 20px;
                border:none;
                border-radius: 3px; 
                margin-left: 13.2%;
                font-size:16px;
                padding: 10px;
                background-color: #3B6190;
                color: #fff;
            }
            
            .clear-meetup{
                margin-left:6.6%;
                color: #999;
                background: none;
                
                
            }
            
            .meetupNum{
                margin-left: -10px;
                margin-top: 0px;
                margin-bottom:0px;
                font-size:27px;
            }
            
            #code-preview{ margin-top: 20px;
                           height: 200px;
                           overflow: scroll;
            }
            #footer{
                display: block;
                margin: 10px auto;
                height: 200px;
                width: 400px;
                list-style-type: none;
                text-align: center;
                padding: 0px;
            }
            
        
            
           
            
        </style>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <div class="form-title">
            <div class="container">
                <h2 class="col-md-10 col-md-offset-1" style="padding-left:30px !important;"><span>Event/Meetup Email</span> Generator</h2>
            </div>
        </div>
            
        <div class="container" id="main">
            <div class="row col-md-10 col-md-offset-1 col-sm-10">
                <div class="col-md-12 col-sm-12 container" id="form">
                    <div class="row"> 
                        <div class="col-md-5 col-sm-10">
                            <h2 id="week">The Week Of</h2><input id="week-of" type="date" />
                            <a id="set-week" class="btn btn-sm">Edit</a>
                        </div>
                        <div class=col-md-2">
                           
                        </div>
                    </div>
                    <div class="row top-buffer">
                        <div class="col-md-12 col-sm-12">
                            <h3 id="weeklyMsg-title">Weekly Message</h3>
                             <textarea id="weeklyMessage" class="input-style"></textarea>
                        </div>
                     </div>
                     <div class="row">
                        <div class="col-md-8 col-sm-12">
                    
                            <button id="add-meet-up" class="btn" >Add Meetup</button>
                            <button id="generate-html" class="btn" >Generate</button><br /><br />
                           
                        </div>
                    </div>
                </div>
                <div class="col-md-12" id="preview">
                    <p class="form-control" id="code-preview">
                        
                    </p>
                </div>
                <div class="col-md-12" >
                    <ul id="footer">
                        <li>Made by Deyan Dimov <span>- West Monroe Partners Chicago, 2016</span></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.3.min.js"><\/script>')</script>
        <script>
            
        </script>
    </body>
</html>
